# 2. 데이터 모델과 질의 언어

## 요약

역사적으로 데이터를 하나의 큰 트리(계층 모델)로 표현하려고 노력했지만 다대다 관계를 표현하기에는 트리 구조가 적절하지 않았다. 이 문제를 해결하기 위해 관계형 모델이 고안됐다.

최근 개발자들은 관계형 모델에도 적합하지 않은 애플리케이션이 있다는 사실을 발견했다. 새롭게 등장한 비관계형 데이터저장소인 “NoSQL”은 다음과 같은 두 가지 주요 갈래가 있다.

- **문서 데이터베이스**: 데이터가 문서 자체에 포함되어 있으면서 하나의 문서와 다른 문서 간의 관계가 거의 없는 사용 사례를 대상으로 한다.
- **그래프 데이터베이스**: 문서 데이터베이스와는 정반대로 모든 것이 잠재적으로 관련 있다는 사용 사례를 대상으로 한다.

한 모델을 다른 모델로 흉내 낼 수 있지만 그 결과는 대부분 엉망이다. 이것이 바로 단일 만능 솔루션이 아닌 각기 목적에 맞는 다양한 시스템을 보유해야 하는 이유다.

따라서, 모든 요구사항을 만족하는 단 하나의 데이터 모델은 없으며, 애플리케이션의 데이터 관계가 얼마나 복잡하고 데이터 구조가 가변적인지에 따라 적절한 모델을 선택해야 한다.

## 관계형 데이터베이스

- 컬럼 추가할 때 ALTER TABLE
- 구조가 자주 바뀌는 서비스에 불리
- JOIN이 많아질수록 복잡

- mysql, postgresql, oracle, sqlserver

## 문서 데이터베이스

- 서비스 데이터 그대로 저장
- API 응답 구조 = DB 구조
- 빠른 개발

- MongoDB

- 로그, 사용자 프로필

## 그래프 데이터베이스

- Node / Edge
- 관계 자체가 1급 시민
- 데이터 간의 다대다 관계가 매우 빈번하고 복잡할 때 적합

- Neo4j

- SNS 관계, 추천 시스템, 조직도

## 질의 언어

### 선언적 질의 언어

SQL과 같이 어떻게가 아닌 무엇을 원하는지만 명시하는 방식이다. 데이터베이스 엔진의 최적화기가 실행 순서를 결정하므로 효율적이며 병렬 실행에 유리하다.

### 명령형 질의 언어

컴퓨터가 특정 순서대로 작업을 수행하도록 지시하는 방식이다.

## MapReduce 데이터 처리 흐름

1. 입력 데이터 읽기
    - HDFS 같은 분산 스토리지에서 데이터를 읽음
    - 한 번에 큰 배치 단위로 읽음
2. Map 단계
    - 각 데이터 조각을 키-값 쌍으로 변환
    - 필요하면 필터/전처리 수행
3. Shuffle & Sort 단계
    - 같은 키끼리 데이터를 모음
    - 분산 환경에서 데이터를 네트워크로 이동
4. Reduce 단계
    - 모인 데이터를 집계/연산
    - 결과를 다시 HDFS 등 스토리지에 저장
5. 배치 완료
    - 한 번 실행하면 끝
    - 실시간 데이터 처리 불가
    
- 배치 단위 처리
- 전체 데이터를 읽고 처리 후 저장
- 스트리밍 불가
